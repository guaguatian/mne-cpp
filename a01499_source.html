<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>MNE-CPP Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a class="site-logo" href="http://www.mne-cpp.org/" title="A Framework for Electrophysiology"><img alt="Logo" src="MNE-CPP_Doxygen_Logo.svg"/></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MNE-CPP
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">A Framework for Electrophysiology</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_9bc903d39c9054df3fab31138488a7be.html">rtprocessing</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">rtnoise.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="a01499.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//=============================================================================================================</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"></span><span class="comment">//*************************************************************************************************************</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">//=============================================================================================================</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">// INCLUDES</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">//=============================================================================================================</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a01502.html">rtnoise.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="a00845.html">fiff/fiff_cov.h</a>&gt;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">//*************************************************************************************************************</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">//=============================================================================================================</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">// QT INCLUDES</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">//=============================================================================================================</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &lt;QDebug&gt;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">//*************************************************************************************************************</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">//=============================================================================================================</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">// USED NAMESPACES</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">//=============================================================================================================</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="keyword">using namespace </span><a class="code" href="a03182.html">RTPROCESSINGLIB</a>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">using namespace </span><a class="code" href="a03162.html">FIFFLIB</a>;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">//*************************************************************************************************************</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">//=============================================================================================================</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">// DEFINE MEMBER METHODS</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">//=============================================================================================================</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="a04743.html#aa02efc900cd51020f821a3186a2d6f4e">   72</a></span>&#160;<a class="code" href="a04743.html#aa02efc900cd51020f821a3186a2d6f4e">RtNoise::RtNoise</a>(qint32 p_iMaxSamples, <a class="code" href="a03927.html#abfce6128814de61b3fdd324a97918338">FiffInfo::SPtr</a> p_pFiffInfo, qint32 p_dataLen, QObject *parent)</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;: QThread(parent)</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;, m_iFFTlength(p_iMaxSamples)</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;, m_pFiffInfo(p_pFiffInfo)</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;, m_dataLength(p_dataLen)</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;, m_bIsRunning(false)</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;, m_iNumOfBlocks(0)</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;, m_iBlockSize(0)</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;, m_iSensors(0)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;, m_iBlockIndex(0)</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;{</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    qRegisterMetaType&lt;Eigen::MatrixXd&gt;(<span class="stringliteral">&quot;Eigen::MatrixXd&quot;</span>);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">//qRegisterMetaType&lt;QVector&lt;double&gt; &gt;(&quot;QVector&lt;double&gt;&quot;);</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    m_Fs = m_pFiffInfo-&gt;sfreq;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    m_bSendDataToBuffer = <span class="keyword">true</span>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    m_fWin.clear();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">//create a hanning window</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    m_fWin = hanning(m_iFFTlength,0);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    qDebug()&lt;&lt;<span class="stringliteral">&quot;Hanning window is created.&quot;</span>;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">//*************************************************************************************************************</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="a04743.html#a53a01ea62f509bb092c3434fc5cffc22">  102</a></span>&#160;<a class="code" href="a04743.html#a53a01ea62f509bb092c3434fc5cffc22">RtNoise::~RtNoise</a>()</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;{</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="a04743.html#a18b0ff77c4a06f5f1f583e3b80080dc4">isRunning</a>()){</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <a class="code" href="a04743.html#adcb945c3badc9eac97395586a7419c02">stop</a>();</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">//*************************************************************************************************************</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;QVector &lt;float&gt; RtNoise::hanning(<span class="keywordtype">int</span> N, <span class="keywordtype">short</span> itype)</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;{</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordtype">int</span> half, i, idx, n;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    QVector &lt;float&gt; w(N,0.0);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">if</span>(itype==1)    <span class="comment">//periodic function</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        n = N-1;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        n = N;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span>(n%2==0)</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        half = n/2;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;half; i++) <span class="comment">//CALC_HANNING   Calculates Hanning window samples.</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            w[i] = 0.5 * (1 - cos(2*3.14159265*(i+1) / (n+1)));</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        idx = half-1;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">for</span>(i=half; i&lt;n; i++) {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            w[i] = w[idx];</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            idx--;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        half = (n+1)/2;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;half; i++) <span class="comment">//CALC_HANNING   Calculates Hanning window samples.</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            w[i] = 0.5 * (1 - cos(23.14159265*(i+1) / (n+1)));</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        idx = half-2;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">for</span>(i=half; i&lt;n; i++) {</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            w[i] = w[idx];</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            idx--;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">if</span>(itype==1)    <span class="comment">//periodic function</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">for</span>(i=N-1; i&gt;=1; i--)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            w[i] = w[i-1];</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        w[0] = 0.0;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">return</span>(w);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;}</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">//*************************************************************************************************************</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="a04743.html#a46547d0186e3cdc960c0cd5f27784c1d">  157</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="a04743.html#a46547d0186e3cdc960c0cd5f27784c1d">RtNoise::append</a>(<span class="keyword">const</span> MatrixXd &amp;p_DataSegment)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;{</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span>(!m_pRawMatrixBuffer)</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        m_pRawMatrixBuffer = <a class="code" href="a04783.html#a8cf538a5e32c7a7173a7e78229d297aa">CircularMatrixBuffer&lt;double&gt;::SPtr</a>(<span class="keyword">new</span> <a class="code" href="a04783.html">CircularMatrixBuffer&lt;double&gt;</a>(8, p_DataSegment.rows(), p_DataSegment.cols()));</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span> (m_bSendDataToBuffer)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        m_pRawMatrixBuffer-&gt;<a class="code" href="a04783.html#aa43706aa6110e3e799c58652d3af91be">push</a>(&amp;p_DataSegment);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">//*************************************************************************************************************</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="a04743.html#accd754d50adc8e853179e61e413baa70">  169</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="a04743.html#accd754d50adc8e853179e61e413baa70">RtNoise::start</a>()</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;{</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">//Check if the thread is already or still running. This can happen if the start button is pressed immediately after the stop button was pressed. In this case the stopping process is not finished yet but the start process is initiated.</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="a04743.html#a18b0ff77c4a06f5f1f583e3b80080dc4">isRunning</a>())</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        QThread::wait();</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    m_bIsRunning = <span class="keyword">true</span>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    QThread::start();</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;}</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">//*************************************************************************************************************</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="a04743.html#adcb945c3badc9eac97395586a7419c02">  184</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="a04743.html#adcb945c3badc9eac97395586a7419c02">RtNoise::stop</a>()</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;{</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    m_bIsRunning = <span class="keyword">false</span>;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    m_pRawMatrixBuffer-&gt;<a class="code" href="a04783.html#a47b3787b6eee3c1e8160821d5e3ad054">releaseFromPop</a>();</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    m_pRawMatrixBuffer-&gt;<a class="code" href="a04783.html#a0d4698e93a2cd596858eb80d929c36a7">clear</a>();</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    qDebug()&lt;&lt;<span class="stringliteral">&quot; RtNoise Thread is stopped.&quot;</span>;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">//*************************************************************************************************************</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="a04743.html#a1af28a6e79fce1c8cba943023b4328b8">  200</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="a04743.html#a1af28a6e79fce1c8cba943023b4328b8">RtNoise::run</a>()</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;{</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor">    #ifdef EIGEN_FFTW_DEFAULT</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        fftw_make_planner_thread_safe();</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="preprocessor">    #endif</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordtype">bool</span> FirstStart = <span class="keyword">true</span>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">while</span>(m_bIsRunning)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">if</span>(m_pRawMatrixBuffer)</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            MatrixXd block = m_pRawMatrixBuffer-&gt;<a class="code" href="a04783.html#aa8d868b14887588ea01039e7ea906e9f">pop</a>();</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <span class="keywordflow">if</span>(FirstStart){</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                <span class="comment">//init the circ buffer and parameters</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                <span class="keywordflow">if</span>(m_dataLength &lt; 0) m_dataLength = 10;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                m_iNumOfBlocks = m_dataLength;<span class="comment">//60;</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                m_iBlockSize =  block.cols();</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                m_iSensors =  block.rows();</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                m_matCircBuf.resize(m_iSensors,m_iNumOfBlocks*m_iBlockSize);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                m_iBlockIndex = 0;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                FirstStart = <span class="keyword">false</span>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="comment">//concate blocks</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; m_iSensors; i++)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt; m_iBlockSize; j++)</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                    m_matCircBuf(i,j+m_iBlockIndex*m_iBlockSize) = block(i,j);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            m_iBlockIndex ++;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordflow">if</span> (m_iBlockIndex &gt;= m_iNumOfBlocks){</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="comment">//m_pRawMatrixBuffer.clear(); //empty the buffer</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                m_bSendDataToBuffer = <span class="keyword">false</span>;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <span class="comment">//stop collect block and start to calculate the spectrum</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                m_iBlockIndex = 0;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                MatrixXd sum_psdx = MatrixXd::Zero(m_iSensors,m_iFFTlength/2+1);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                <span class="keywordtype">int</span> nb = floor(m_iNumOfBlocks*m_iBlockSize/m_iFFTlength)+1;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                qDebug()&lt;&lt;<span class="stringliteral">&quot;nb&quot;</span>&lt;&lt;nb&lt;&lt;<span class="stringliteral">&quot;NumOfBlocks&quot;</span>&lt;&lt;m_iNumOfBlocks&lt;&lt;<span class="stringliteral">&quot;BlockSize&quot;</span>&lt;&lt;m_iBlockSize;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                MatrixXd t_mat(m_iSensors,m_iFFTlength);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                MatrixXd t_psdx(m_iSensors,m_iFFTlength/2+1);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n&lt;nb; n++){</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    <span class="comment">//collect a data block with data length of m_iFFTlength;</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                    <span class="keywordflow">if</span>(n==nb-1)</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                    {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                        <span class="keywordflow">for</span>(qint32 ii=0; ii&lt;m_iSensors; ii++)</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                        <span class="keywordflow">for</span>(qint32 jj=0; jj&lt;m_iFFTlength; jj++)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                            <span class="keywordflow">if</span>(jj+n*m_iFFTlength&lt;m_iNumOfBlocks*m_iBlockSize)</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                t_mat(ii,jj) = m_matCircBuf(ii,jj+n*m_iFFTlength);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                t_mat(ii,jj) = 0.0;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                    }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                        <span class="keywordflow">for</span>(qint32 ii=0; ii&lt;m_iSensors; ii++)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                        <span class="keywordflow">for</span>(qint32 jj=0; jj&lt;m_iFFTlength; jj++)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                            t_mat(ii,jj) = m_matCircBuf(ii,jj+n*m_iFFTlength);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                    }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                    <span class="comment">//FFT calculation by row</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                    <span class="keywordflow">for</span>(qint32 i = 0; i &lt; t_mat.rows(); i++){</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                        RowVectorXd data;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                        data = t_mat.row(i);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                        <span class="comment">//zero-pad data to m_iFFTlength</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                        RowVectorXd t_dataZeroPad = RowVectorXd::Zero(m_iFFTlength);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                        t_dataZeroPad.head(data.cols()) = data;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        <span class="keywordflow">for</span> (qint32 lk = 0; lk&lt;m_iFFTlength; lk++)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                            t_dataZeroPad[lk] = t_dataZeroPad[lk]*m_fWin[lk];</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                        <span class="comment">//generate fft object</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                        Eigen::FFT&lt;double&gt; fft;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                        fft.SetFlag(fft.HalfSpectrum);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                        <span class="comment">//fft-transform data sequence</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                        RowVectorXcd t_freqData(m_iFFTlength/2+1);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                        fft.fwd(t_freqData,t_dataZeroPad);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                        <span class="comment">// calculate spectrum from FFT</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                        <span class="keywordflow">for</span>(qint32 j=0; j&lt;m_iFFTlength/2+1;j++)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                        {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                            <span class="keywordtype">double</span> mag_abs = sqrt(t_freqData(j).real()* t_freqData(j).real() +  t_freqData(j).imag()*t_freqData(j).imag());</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                            <span class="keywordtype">double</span> spower = (1.0/(m_Fs*m_iFFTlength))* mag_abs;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                            <span class="keywordflow">if</span> (j&gt;0&amp;&amp;j&lt;m_iFFTlength/2) spower = 2.0*spower;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                            sum_psdx(i,j) = sum_psdx(i,j) + spower;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                        }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                     }<span class="comment">//row computing is done</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                }<span class="comment">//nb</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <span class="comment">//DB-calculation</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                <span class="keywordflow">for</span>(qint32 ii=0; ii&lt;m_iSensors; ii++)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                    <span class="keywordflow">for</span>(qint32 jj=0; jj&lt;m_iFFTlength/2+1; jj++)</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                        t_psdx(ii,jj) = 10.0*log10(sum_psdx(ii,jj)/nb);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                qDebug()&lt;&lt;<span class="stringliteral">&quot;Send spectrum to Noise Estimator&quot;</span>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                emit <a class="code" href="a04743.html#a8a0b3299cce7486fd0924e79e6703823">SpecCalculated</a>(t_psdx); <span class="comment">//send back the spectrum result</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                <span class="keywordflow">if</span>(m_pRawMatrixBuffer-&gt;<a class="code" href="a04783.html#a1f19c4c19a917c28fcf693700d82f8fd">size</a>()&gt;0)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                    m_pRawMatrixBuffer-&gt;<a class="code" href="a04783.html#a0d4698e93a2cd596858eb80d929c36a7">clear</a>();</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                m_bSendDataToBuffer = <span class="keyword">true</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        }</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="ttc" id="a01502_html"><div class="ttname"><a href="a01502.html">rtnoise.h</a></div><div class="ttdoc">RtNoise class declaration. </div></div>
<div class="ttc" id="a04783_html_aa43706aa6110e3e799c58652d3af91be"><div class="ttname"><a href="a04783.html#aa43706aa6110e3e799c58652d3af91be">IOBUFFER::CircularMatrixBuffer::push</a></div><div class="ttdeci">void push(const Matrix&lt; _Tp, Dynamic, Dynamic &gt; *pMatrix)</div><div class="ttdef"><b>Definition:</b> <a href="a01562_source.html#l00243">circularmatrixbuffer.h:243</a></div></div>
<div class="ttc" id="a04743_html_adcb945c3badc9eac97395586a7419c02"><div class="ttname"><a href="a04743.html#adcb945c3badc9eac97395586a7419c02">RTPROCESSINGLIB::RtNoise::stop</a></div><div class="ttdeci">virtual bool stop()</div><div class="ttdef"><b>Definition:</b> <a href="a01499_source.html#l00184">rtnoise.cpp:184</a></div></div>
<div class="ttc" id="a04783_html_a8cf538a5e32c7a7173a7e78229d297aa"><div class="ttname"><a href="a04783.html#a8cf538a5e32c7a7173a7e78229d297aa">IOBUFFER::CircularMatrixBuffer::SPtr</a></div><div class="ttdeci">QSharedPointer&lt; CircularMatrixBuffer &gt; SPtr</div><div class="ttdef"><b>Definition:</b> <a href="a01562_source.html#l00103">circularmatrixbuffer.h:103</a></div></div>
<div class="ttc" id="a04743_html_a8a0b3299cce7486fd0924e79e6703823"><div class="ttname"><a href="a04743.html#a8a0b3299cce7486fd0924e79e6703823">RTPROCESSINGLIB::RtNoise::SpecCalculated</a></div><div class="ttdeci">void SpecCalculated(Eigen::MatrixXd)</div></div>
<div class="ttc" id="a03927_html_abfce6128814de61b3fdd324a97918338"><div class="ttname"><a href="a03927.html#abfce6128814de61b3fdd324a97918338">FIFFLIB::FiffInfo::SPtr</a></div><div class="ttdeci">QSharedPointer&lt; FiffInfo &gt; SPtr</div><div class="ttdef"><b>Definition:</b> <a href="a00908_source.html#l00099">fiff_info.h:99</a></div></div>
<div class="ttc" id="a03162_html"><div class="ttname"><a href="a03162.html">FIFFLIB</a></div><div class="ttdef"><b>Definition:</b> <a href="a00059_source.html#l00079">connectivitysettings.h:79</a></div></div>
<div class="ttc" id="a04783_html_aa8d868b14887588ea01039e7ea906e9f"><div class="ttname"><a href="a04783.html#aa8d868b14887588ea01039e7ea906e9f">IOBUFFER::CircularMatrixBuffer::pop</a></div><div class="ttdeci">Matrix&lt; _Tp, Dynamic, Dynamic &gt; pop()</div><div class="ttdef"><b>Definition:</b> <a href="a01562_source.html#l00266">circularmatrixbuffer.h:266</a></div></div>
<div class="ttc" id="a04783_html_a0d4698e93a2cd596858eb80d929c36a7"><div class="ttname"><a href="a04783.html#a0d4698e93a2cd596858eb80d929c36a7">IOBUFFER::CircularMatrixBuffer::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="a01562_source.html#l00299">circularmatrixbuffer.h:299</a></div></div>
<div class="ttc" id="a03182_html"><div class="ttname"><a href="a03182.html">RTPROCESSINGLIB</a></div><div class="ttdef"><b>Definition:</b> <a href="a01466_source.html#l00080">rtave.h:80</a></div></div>
<div class="ttc" id="a04783_html_a47b3787b6eee3c1e8160821d5e3ad054"><div class="ttname"><a href="a04783.html#a47b3787b6eee3c1e8160821d5e3ad054">IOBUFFER::CircularMatrixBuffer::releaseFromPop</a></div><div class="ttdeci">bool releaseFromPop()</div><div class="ttdef"><b>Definition:</b> <a href="a01562_source.html#l00350">circularmatrixbuffer.h:350</a></div></div>
<div class="ttc" id="a04783_html"><div class="ttname"><a href="a04783.html">IOBUFFER::CircularMatrixBuffer&lt; double &gt;</a></div></div>
<div class="ttc" id="a04743_html_a46547d0186e3cdc960c0cd5f27784c1d"><div class="ttname"><a href="a04743.html#a46547d0186e3cdc960c0cd5f27784c1d">RTPROCESSINGLIB::RtNoise::append</a></div><div class="ttdeci">void append(const MatrixXd &amp;p_DataSegment)</div><div class="ttdef"><b>Definition:</b> <a href="a01499_source.html#l00157">rtnoise.cpp:157</a></div></div>
<div class="ttc" id="a04743_html_a18b0ff77c4a06f5f1f583e3b80080dc4"><div class="ttname"><a href="a04743.html#a18b0ff77c4a06f5f1f583e3b80080dc4">RTPROCESSINGLIB::RtNoise::isRunning</a></div><div class="ttdeci">bool isRunning()</div><div class="ttdef"><b>Definition:</b> <a href="a01502_source.html#l00222">rtnoise.h:222</a></div></div>
<div class="ttc" id="a00845_html"><div class="ttname"><a href="a00845.html">fiff_cov.h</a></div><div class="ttdoc">FiffCov class declaration. </div></div>
<div class="ttc" id="a04743_html_a1af28a6e79fce1c8cba943023b4328b8"><div class="ttname"><a href="a04743.html#a1af28a6e79fce1c8cba943023b4328b8">RTPROCESSINGLIB::RtNoise::run</a></div><div class="ttdeci">virtual void run()</div><div class="ttdef"><b>Definition:</b> <a href="a01499_source.html#l00200">rtnoise.cpp:200</a></div></div>
<div class="ttc" id="a04743_html_accd754d50adc8e853179e61e413baa70"><div class="ttname"><a href="a04743.html#accd754d50adc8e853179e61e413baa70">RTPROCESSINGLIB::RtNoise::start</a></div><div class="ttdeci">virtual bool start()</div><div class="ttdef"><b>Definition:</b> <a href="a01499_source.html#l00169">rtnoise.cpp:169</a></div></div>
<div class="ttc" id="a04783_html_a1f19c4c19a917c28fcf693700d82f8fd"><div class="ttname"><a href="a04783.html#a1f19c4c19a917c28fcf693700d82f8fd">IOBUFFER::CircularMatrixBuffer::size</a></div><div class="ttdeci">quint32 size() const</div><div class="ttdef"><b>Definition:</b> <a href="a01562_source.html#l00314">circularmatrixbuffer.h:314</a></div></div>
<div class="ttc" id="a04743_html_a53a01ea62f509bb092c3434fc5cffc22"><div class="ttname"><a href="a04743.html#a53a01ea62f509bb092c3434fc5cffc22">RTPROCESSINGLIB::RtNoise::~RtNoise</a></div><div class="ttdeci">~RtNoise()</div><div class="ttdef"><b>Definition:</b> <a href="a01499_source.html#l00102">rtnoise.cpp:102</a></div></div>
<div class="ttc" id="a04743_html_aa02efc900cd51020f821a3186a2d6f4e"><div class="ttname"><a href="a04743.html#aa02efc900cd51020f821a3186a2d6f4e">RTPROCESSINGLIB::RtNoise::RtNoise</a></div><div class="ttdeci">RtNoise(qint32 p_iMaxSamples, FiffInfo::SPtr p_pFiffInfo, qint32 p_dataLen, QObject *parent=0)</div><div class="ttdef"><b>Definition:</b> <a href="a01499_source.html#l00072">rtnoise.cpp:72</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Dec 18 2019 19:35:44
</small></address>
</body>
</html>